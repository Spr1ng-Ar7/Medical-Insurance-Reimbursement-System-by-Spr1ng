# 医保报销系统权限树设计文档

## 1. 权限系统概述

### 1.1 设计目标
- 实现基于RBAC（Role-Based Access Control）的权限控制
- 支持多级菜单权限和按钮级权限
- 提供灵活的权限分配和管理功能
- 确保系统安全性和可扩展性

### 1.2 核心概念
- **权限（Permission）**：系统中最小的权限单元，可以是菜单、按钮或API接口
- **角色（Role）**：权限的集合，用户通过角色获得权限
- **管理员（Admin）**：系统用户，可以分配一个或多个角色
- **权限树**：以树形结构组织的权限层级关系

## 2. 权限树结构设计

### 2.1 权限层级结构
```
医保报销系统权限树
├── 系统管理 (system:manage)
│   ├── 管理员管理 (system:admin:view)
│   │   ├── 管理员列表 (system:admin:list)
│   │   ├── 新增管理员 (system:admin:add)
│   │   ├── 编辑管理员 (system:admin:edit)
│   │   ├── 删除管理员 (system:admin:delete)
│   │   └── 启用/禁用管理员 (system:admin:status)
│   ├── 角色管理 (system:role:view)
│   │   ├── 角色列表 (system:role:list)
│   │   ├── 新增角色 (system:role:add)
│   │   ├── 编辑角色 (system:role:edit)
│   │   ├── 删除角色 (system:role:delete)
│   │   └── 角色权限分配 (system:role:permission)
│   ├── 权限管理 (system:permission:view)
│   │   ├── 权限列表 (system:permission:list)
│   │   ├── 权限树 (system:permission:tree)
│   │   ├── 新增权限 (system:permission:add)
│   │   ├── 编辑权限 (system:permission:edit)
│   │   └── 删除权限 (system:permission:delete)
│   └── 部门管理 (system:dept:view)
│       ├── 部门列表 (system:dept:list)
│       ├── 新增部门 (system:dept:add)
│       ├── 编辑部门 (system:dept:edit)
│       └── 删除部门 (system:dept:delete)
├── 基础数据管理 (basic:manage)
│   ├── 药品管理 (basic:drug:view)
│   │   ├── 药品列表 (basic:drug:list)
│   │   ├── 新增药品 (basic:drug:add)
│   │   ├── 编辑药品 (basic:drug:edit)
│   │   ├── 删除药品 (basic:drug:delete)
│   │   ├── 药品导入 (basic:drug:import)
│   │   └── 药品导出 (basic:drug:export)
│   ├── 医疗服务管理 (basic:service:view)
│   │   ├── 服务列表 (basic:service:list)
│   │   ├── 新增服务 (basic:service:add)
│   │   ├── 编辑服务 (basic:service:edit)
│   │   └── 删除服务 (basic:service:delete)
│   ├── 医疗器械管理 (basic:equipment:view)
│   │   ├── 设备列表 (basic:equipment:list)
│   │   ├── 新增设备 (basic:equipment:add)
│   │   ├── 编辑设备 (basic:equipment:edit)
│   │   └── 删除设备 (basic:equipment:delete)
│   ├── 疾病编码管理 (basic:disease:view)
│   │   ├── 疾病列表 (basic:disease:list)
│   │   ├── 新增疾病 (basic:disease:add)
│   │   ├── 编辑疾病 (basic:disease:edit)
│   │   └── 删除疾病 (basic:disease:delete)
│   ├── 医院管理 (basic:hospital:view)
│   │   ├── 医院列表 (basic:hospital:list)
│   │   ├── 新增医院 (basic:hospital:add)
│   │   ├── 编辑医院 (basic:hospital:edit)
│   │   └── 删除医院 (basic:hospital:delete)
│   └── 报销等级管理 (basic:reimbursement:view)
│       ├── 等级列表 (basic:reimbursement:list)
│       ├── 新增等级 (basic:reimbursement:add)
│       ├── 编辑等级 (basic:reimbursement:edit)
│       └── 删除等级 (basic:reimbursement:delete)
├── 业务管理 (business:manage)
│   ├── 患者管理 (business:patient:view)
│   │   ├── 患者列表 (business:patient:list)
│   │   ├── 新增患者 (business:patient:add)
│   │   ├── 编辑患者 (business:patient:edit)
│   │   ├── 删除患者 (business:patient:delete)
│   │   └── 患者详情 (business:patient:detail)
│   ├── 医疗订单管理 (business:order:view)
│   │   ├── 订单列表 (business:order:list)
│   │   ├── 新增订单 (business:order:add)
│   │   ├── 编辑订单 (business:order:edit)
│   │   ├── 删除订单 (business:order:delete)
│   │   └── 订单详情 (business:order:detail)
│   └── 报销结算管理 (business:settlement:view)
│       ├── 结算列表 (business:settlement:list)
│       ├── 新增结算 (business:settlement:add)
│       ├── 编辑结算 (business:settlement:edit)
│       ├── 删除结算 (business:settlement:delete)
│       ├── 结算详情 (business:settlement:detail)
│       └── 计算报销 (business:settlement:calculate)
├── 数据管理 (data:manage)
│   ├── Excel导入管理 (data:import:view)
│   │   ├── 文件上传 (data:import:upload)
│   │   ├── 数据验证 (data:import:validate)
│   │   ├── 数据导入 (data:import:import)
│   │   └── 下载模板 (data:import:template)
│   └── 数据统计 (data:statistics:view)
│       ├── 药品统计 (data:statistics:drug)
│       ├── 结算统计 (data:statistics:settlement)
│       └── 患者统计 (data:statistics:patient)
└── 系统监控 (monitor:manage)
    ├── 操作日志 (monitor:log:view)
    │   ├── 日志列表 (monitor:log:list)
    │   ├── 日志详情 (monitor:log:detail)
    │   └── 删除日志 (monitor:log:delete)
    └── 系统信息 (monitor:system:view)
        ├── 系统信息 (monitor:system:info)
        └── 健康检查 (monitor:system:health)
```

### 2.2 权限编码规范
- **格式**：`模块:功能:操作`
- **示例**：
  - `system:admin:view` - 系统管理-管理员管理-查看
  - `basic:drug:add` - 基础数据-药品管理-新增
  - `business:settlement:calculate` - 业务管理-报销结算-计算

### 2.3 权限类型
- **menu**：菜单权限，控制页面访问
- **button**：按钮权限，控制按钮显示和操作
- **api**：接口权限，控制API接口访问

## 3. 数据库设计

### 3.1 权限表（sys_permission）
```sql
CREATE TABLE sys_permission (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    permission_code VARCHAR(100) NOT NULL COMMENT '权限编码',
    permission_name VARCHAR(100) NOT NULL COMMENT '权限名称',
    resource_type VARCHAR(20) NOT NULL COMMENT '资源类型：menu-菜单，button-按钮，api-接口',
    resource_path VARCHAR(200) COMMENT '资源路径',
    http_method VARCHAR(10) COMMENT 'HTTP方法：GET,POST,PUT,DELETE',
    parent_id BIGINT DEFAULT 0 COMMENT '父权限ID',
    level INT DEFAULT 1 COMMENT '层级',
    sort_order INT DEFAULT 0 COMMENT '排序',
    icon VARCHAR(100) COMMENT '图标',
    status INT DEFAULT 1 COMMENT '状态：1-正常，0-禁用',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    create_by VARCHAR(50) COMMENT '创建人',
    update_by VARCHAR(50) COMMENT '更新人',
    remark VARCHAR(500) COMMENT '备注',
    UNIQUE KEY uk_permission_code (permission_code)
);
```

### 3.2 角色表（sys_role）
```sql
CREATE TABLE sys_role (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_code VARCHAR(50) NOT NULL COMMENT '角色编码',
    role_name VARCHAR(50) NOT NULL COMMENT '角色名称',
    description VARCHAR(200) COMMENT '角色描述',
    status INT DEFAULT 1 COMMENT '状态：1-正常，0-禁用',
    sort_order INT DEFAULT 0 COMMENT '排序',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    create_by VARCHAR(50) COMMENT '创建人',
    update_by VARCHAR(50) COMMENT '更新人',
    remark VARCHAR(500) COMMENT '备注',
    UNIQUE KEY uk_role_code (role_code)
);
```

### 3.3 角色权限关联表（sys_role_permission）
```sql
CREATE TABLE sys_role_permission (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_id BIGINT NOT NULL COMMENT '角色ID',
    permission_id BIGINT NOT NULL COMMENT '权限ID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_role_permission (role_id, permission_id)
);
```

## 4. 权限控制实现

### 4.1 前端权限控制
- **路由权限**：根据用户权限动态生成路由
- **菜单权限**：根据权限控制菜单显示
- **按钮权限**：使用指令控制按钮显示和操作

### 4.2 后端权限控制
- **接口权限**：使用注解或拦截器验证接口权限
- **数据权限**：根据用户角色过滤数据访问范围
- **操作日志**：记录用户操作行为

### 4.3 权限验证流程
1. 用户登录后获取角色和权限信息
2. 前端根据权限动态生成菜单和路由
3. 用户访问页面时验证页面权限
4. 用户操作时验证按钮和接口权限
5. 后端接口验证用户权限后执行业务逻辑

## 5. 角色设计

### 5.1 超级管理员（super_admin）
- 拥有所有权限
- 可以管理其他管理员
- 可以配置系统参数

### 5.2 普通管理员（admin）
- 基础数据管理权限
- 业务管理权限
- 数据统计权限

### 5.3 操作员（operator）
- 患者管理权限
- 订单管理权限
- 结算管理权限

### 5.4 查看员（viewer）
- 只读权限
- 可以查看统计数据
- 不能进行增删改操作

## 6. 权限管理功能

### 6.1 权限管理
- 权限树展示
- 权限增删改查
- 权限状态管理
- 权限排序调整

### 6.2 角色管理
- 角色增删改查
- 角色权限分配
- 角色状态管理
- 角色排序调整

### 6.3 管理员管理
- 管理员增删改查
- 管理员角色分配
- 管理员状态管理
- 管理员密码重置

## 7. 安全考虑

### 7.1 权限验证
- 前端和后端双重验证
- 接口级别的权限控制
- 数据级别的权限过滤

### 7.2 操作审计
- 记录用户操作日志
- 敏感操作二次确认
- 异常操作告警

### 7.3 数据安全
- 敏感数据加密存储
- 数据传输加密
- 定期数据备份

## 8. 扩展性设计

### 8.1 权限扩展
- 支持自定义权限类型
- 支持动态权限配置
- 支持权限模板

### 8.2 角色扩展
- 支持角色继承
- 支持临时权限
- 支持权限组

### 8.3 系统集成
- 支持LDAP集成
- 支持单点登录
- 支持第三方认证

## 9. 部署和维护

### 9.1 初始化
- 执行权限树初始化脚本
- 创建默认角色和管理员
- 配置基础权限

### 9.2 监控
- 权限使用情况监控
- 异常访问告警
- 性能监控

### 9.3 维护
- 定期权限审计
- 权限优化调整
- 安全漏洞修复 