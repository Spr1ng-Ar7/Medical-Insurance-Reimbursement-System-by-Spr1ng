# 数据库初始化使用说明

## 概述
本文档说明如何使用 `script.sql` 文件初始化医保报销系统的数据库，确保团队成员能够同步数据库的权限和菜单模块。

## 文件说明
`script.sql` 包含了完整的数据库初始化脚本，包括：
- 所有表结构定义
- 系统管理数据（部门、管理员、角色、权限、菜单）
- 业务数据（药品、医疗服务、医疗器械、疾病、医院、患者等）
- 角色权限关联
- 角色菜单关联

## 初始化步骤

### 1. 创建数据库
```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS neuinsurance CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 使用数据库
USE neuinsurance;
```

### 2. 执行初始化脚本
```bash
# 方法1：使用命令行
mysql -u root -p neuinsurance < script.sql

# 方法2：使用MySQL Workbench等工具
# 直接复制 script.sql 内容并执行
```

### 3. 验证初始化结果
```sql
-- 检查表是否创建成功
SHOW TABLES;

-- 检查管理员数据
SELECT id, username, real_name, user_type, role, department, status FROM sys_admin;

-- 检查角色数据
SELECT id, role_code, role_name, status FROM sys_role;

-- 检查菜单数据
SELECT id, menu_name, menu_code, menu_type, status FROM menu;

-- 检查权限数据
SELECT id, permission_code, permission_name, resource_type FROM sys_permission;
```

## 系统账户说明

### 默认管理员账户
| 用户名 | 密码 | 角色 | 权限范围 |
|--------|------|------|----------|
| admin | admin | 超级管理员 | 所有权限 |
| manager | manager | 业务管理员 | 业务管理权限 |
| doctor | doctor | 医生管理员 | 医疗服务权限 |
| finance | finance | 财务管理员 | 财务管理权限 |

### 角色权限说明
1. **超级管理员 (SUPER_ADMIN)**
   - 拥有所有系统权限
   - 可以管理所有模块

2. **系统管理员 (ADMIN)**
   - 系统管理模块权限
   - 管理员、角色、菜单、部门管理

3. **业务管理员 (BUSINESS_ADMIN)**
   - 业务管理模块权限
   - 药品、患者、医疗订单、报销等级管理

4. **医生管理员 (DOCTOR_ADMIN)**
   - 医疗服务模块权限
   - 服务项目、医疗器械、疾病管理

5. **财务管理员 (FINANCE_ADMIN)**
   - 财务管理模块权限
   - 结算、费用明细管理

## 菜单结构

### 系统管理
- 管理员管理
- 角色管理
- 菜单管理
- 部门管理

### 业务管理
- 药品管理
- 患者管理
- 医疗订单
- 报销等级管理

### 医疗服务
- 服务项目管理
- 医疗器械管理
- 疾病管理

### 财务管理
- 结算管理
- 费用明细管理

## 权限体系

### 权限类型
- **menu**: 菜单权限
- **button**: 按钮权限
- **api**: 接口权限

### 权限层级
- 一级：模块权限（如：SYSTEM、BUSINESS）
- 二级：功能权限（如：SYSTEM:ADMIN、BUSINESS:DRUG）
- 三级：操作权限（如：SYSTEM:ADMIN:LIST、BUSINESS:DRUG:ADD）

## 协作开发注意事项

### 1. 数据库同步
- 新成员加入项目时，必须执行完整的 `script.sql` 脚本
- 确保数据库结构与代码中的实体类匹配

### 2. 权限管理
- 新增功能时，需要在 `sys_permission` 表中添加对应权限
- 需要在 `sys_role_permission` 中为角色分配权限
- 需要在 `menu` 表中添加菜单项
- 需要在 `role_menu` 中为角色分配菜单

### 3. 数据一致性
- 修改表结构时，需要同步更新相关的 Mapper XML 文件
- 新增字段时，需要更新实体类和 Mapper 接口

### 4. 测试数据
- 脚本中包含了基础的测试数据
- 可以根据需要添加更多测试数据
- 生产环境部署时需要清理测试数据

## 常见问题

### Q: 执行脚本时提示表已存在错误
A: 删除现有数据库重新创建，或使用 `DROP TABLE IF EXISTS` 语句

### Q: 权限验证失败
A: 检查 `sys_role_permission` 和 `role_menu` 表中的关联数据是否正确

### Q: 菜单不显示
A: 检查 `menu` 表中的 `visible` 和 `status` 字段，确保菜单为显示状态

### Q: 登录失败
A: 检查管理员账户的 `status` 字段是否为 1（正常状态）

## 维护建议

### 1. 定期备份
```sql
-- 备份数据库
mysqldump -u root -p neuinsurance > backup_$(date +%Y%m%d).sql
```

### 2. 版本控制
- 将 `script.sql` 纳入版本控制
- 数据库结构变更时及时更新脚本
- 记录每次变更的内容和原因

### 3. 环境隔离
- 开发环境、测试环境、生产环境使用不同的数据库
- 避免在生产环境直接执行开发脚本

## 联系支持
如果在使用过程中遇到问题，请提供：
1. 错误信息截图
2. 数据库版本信息
3. 执行的具体步骤
4. 相关的日志信息 